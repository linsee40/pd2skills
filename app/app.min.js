var app=angular.module("pd2Skills",[]);app.factory("hashStorage",["$location",function(a){return new HashStorage(a)}]);app.directive("mainSkills",function(){return{restrict:"C",templateUrl:"template/skills.html",controller:"skillsController"}});app.directive("mainPerks",function(){return{restrict:"C",templateUrl:"template/perks.html",controller:"perksController"}});app.directive("mainInfamy",function(){return{restrict:"C",templateUrl:"template/infamy.html",controller:"infamyController"}});app.directive("asideSkills",function(){return{restrict:"C",templateUrl:"template/skills-aside.html"}});app.directive("asidePerks",function(){return{restrict:"C",templateUrl:"template/perks-aside.html"}});app.directive("asideInfamy",function(){return{restrict:"C",templateUrl:"template/infamy-aside.html"}});app.filter("htmlSafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]);app.filter("desc",[function(){return function(a){return a.slice(0).reverse()}}]);app.filter("toArray",[function(){return function(a){return(a instanceof Array)?a:[a]}}]);app.filter("padLeft",[function(){return function(c,b){return a(String(c),b);function a(e,d){if(e.length<d){return a("0"+e,d)}else{return e}}}}]);app.filter("asideText",["$sce",function(a){return function(b){b=b||"";b=b.replace(/\[/g,"<strong>").replace(/\]/g,"</strong>");return a.trustAsHtml(b)}}]);app.filter("deckClassName",[function(){return function(a){a=a||"";a=a.toLowerCase();a=a.replace(/\s/g,"_");a="deck-"+a;return a}}]);app.controller("mainController",["$scope","$q","$http","hashStorage",function(b,a,g,d){b.hashStorage=d;b.display={};b.skillsCalculator=new SkillsCalculator;b.perkDecksCalculator=new PerkDecksCalculator;b.infamyCalculator=new InfamyCalculator;var c=[];c.push(f("skills/config.json",function(i,h){b.skillsCalculator=new SkillsCalculator(i,h.property)}));c.push(f("perks/config.json",function(i,h){b.perkDecksCalculator=new PerkDecksCalculator(i)}));c.push(e("infamy/infamy.json").then(function(h){b.infamyCalculator=new InfamyCalculator(h)}));a.all(c).then(function(h){b.infamyCalculator.setSkillsCalculator(b.skillsCalculator);b.infamyCalculator.load(b.hashStorage);b.skillsCalculator.load(b.hashStorage);b.perkDecksCalculator.load(b.hashStorage);b.hashStorage.clear();b.skillsCalculator.save(b.hashStorage);b.perkDecksCalculator.save(b.hashStorage);b.infamyCalculator.save(b.hashStorage)});b.set=function(h,i){return b[h]=i};function f(h,i){return a(function(k,j){e(h).then(function(l){var n=l.files;var m=n.map(function(p,o){return e(p)});a.all(m).then(function(o){k(i(o,l))})})})}function e(h){return a(function(j,i){g.get(h).success(function(k){j(k)}).error(function(k){i(k)})})}}]);app.controller("skillsController",["$scope",function(c){var d="./skills/";c.set("display",{});c.updateTreeStatus=function(i){return i.getSpendPoint()};c.getAvailable=function(){return c.skillsCalculator.getAvailablePoint()};c.resetTree=function(i){i.unset();i.save(c.hashStorage)};c.resetAll=function(){c.skillsCalculator.unset();c.skillsCalculator.save(c.hashStorage)};function b(i){return["I","II","III","IV","V"][i-1]}function g(j){var i=Math.floor(j/12);var k=Math.min((j-i*12),10);return(i*10+k)}c.getLevel=function(){var i=b(c.infamyCalculator.usedPoint);i=(i)?i+"-":"";var j=g(c.skillsCalculator.getSpendPoint());return i+j};c.getCost=function(){return c.skillsCalculator.getSpendCost()};c.skillHover=function(j,i){if(j.unlockRequire===false){j.require.getTarget().alert=true}h(j,i)};c.skillLeave=function(j,i){if(j.unlockRequire===false){j.require.getTarget().alert=false}};c.skillClick=function(k,j,i){k.unlock();i.save(c.hashStorage)};c.skillRemove=function(k,j,i){k.unset();i.save(c.hashStorage)};c.skillUpdate=function(k,j,i){};c.getIconStyle=function(k){var j=k.name.toLowerCase();var i="./skills/"+j+".png";return{backgroundImage:"url("+i+")"}};c.getClassName=function(j,i){return"skill_"+Number(j)+"-"+Number(i)};function h(j,i){c.display.skill=j;c.display.tier=i}function e(){c.display.skill=false;c.display.tier=false}function f(i){c.display.tree=i}function e(){c.display.tree=false}c.clickTab=function(){e()};function a(k){for(var p=1;p<k.childList.length;p++){var l=k.getChild(p);if(!l.isUnlocked()){if(p==1){return 0}var q=k.getChild(p-1).unlockRequire;var m=l.unlockRequire-q;var o=k.getSpendPoint()-q;var j=Math.floor(o/m*100*0.2);var n=(p-2)*20;return n+j}}return 100}c.getProgressBarStyle=function(i){return{height:a(i)+"%"}}}]);app.controller("perksController",["$scope",function(a){a.set("display",{});a.deckClick=function(c){c.choice();a.perkDecksCalculator.save(a.hashStorage)};a.deckHover=function(c){b(c)};function b(c){a.display.deck=c}a.getIconStyle=function(f){var d=f.name.toLowerCase();var c="./perks/"+d+".png";return{backgroundImage:'url("'+c+'")'}};a.getClassName=function(c){return"deck_"+Number(c)}}]);app.controller("infamyController",["$scope",function(b){b.set("display",{});b.infamyClick=function(d){d.set(true);b.infamyCalculator.save(b.hashStorage)};b.infamyRemove=function(d){d.set(false);b.infamyCalculator.save(b.hashStorage)};b.infamyHover=function(e,d){a(e,d)};b.infamyLeave=function(d){};b.getIconStyle=function(g){var f="infamy";var d="./infamy/"+f+".png";return{backgroundImage:'url("'+d+'")'}};b.getClassName=function(e,d){return"talent_"+Number(e)+"-"+Number(d)};function a(d){b.display.talent=d}function c(){b.display.talent=false}}]);